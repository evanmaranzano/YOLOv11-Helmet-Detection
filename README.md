# åŸºäºæ”¹è¿› YOLOv11 çš„å·¥åœ°å®‰å…¨å¸½ä½©æˆ´æ£€æµ‹ç³»ç»Ÿ
(Safety Helmet Detection System Based on Improved YOLOv11)

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

## 1. é¡¹ç›®ç®€ä»‹
æœ¬é¡¹ç›®åŸºäºæœ€æ–°çš„ **YOLOv11s** æ¨¡å‹è¿›è¡Œæ”¹è¿›ï¼Œé’ˆå¯¹å·¥åœ°åœºæ™¯ä¸‹å°ç›®æ ‡ï¼ˆè¿œè·ç¦»äººå‘˜ï¼‰ã€é®æŒ¡ç­‰éš¾ç‚¹é—®é¢˜ï¼Œæå‡ºäº†å¤šé¡¹åˆ›æ–°ä¼˜åŒ–ã€‚ç³»ç»ŸåŒ…å«å®Œæ•´çš„è®­ç»ƒè®­ç»ƒ pipelineã€æ¶ˆèå®éªŒé…ç½®ä»¥åŠå¯è§†åŒ– Web æ¼”ç¤ºç•Œé¢ã€‚

### ğŸš€ æ ¸å¿ƒåˆ›æ–°ç‚¹ (key Innovations)
1.  **CBAM (Convolutional Block Attention Module)**: åœ¨ Backbone å’Œ Neck ä¹‹é—´å¼•å…¥æ³¨æ„åŠ›æœºåˆ¶ï¼Œå¢å¼ºæ¨¡å‹å¯¹å®‰å…¨å¸½ç‰¹å¾çš„æå–èƒ½åŠ›ï¼Œå‡å°‘èƒŒæ™¯å¹²æ‰°ã€‚
2.  **Inner-WIoU Loss**: å¼•å…¥ Inner-IoU ç»“åˆ WIoU æœºåˆ¶ï¼Œæ›¿æ¢åŸæœ¬çš„ CIoU/DIoUï¼Œé€šè¿‡è¾…åŠ©è¾¹æ¡†ï¼ˆAuxiliary Bounding Boxï¼‰åŠ é€Ÿå›å½’æ”¶æ•›ï¼Œå¹¶æå‡å®šä½ç²¾åº¦ã€‚
3.  **P2 å¾®å°ç›®æ ‡æ£€æµ‹å¤´ (Tiny Object Detection Head)** [New!]: å¢åŠ  P2 (Stride 4) é«˜åˆ†è¾¨ç‡æ£€æµ‹å±‚ï¼Œæ„å»º **4-Head** ç»“æ„ï¼Œæ˜¾è‘—æå‡å¯¹æè¿œã€æå°ç›®æ ‡çš„å¬å›ç‡ã€‚

---

## 2. ç¯å¢ƒæ­å»º (Environment Setup)

### 2.1 Conda ç¯å¢ƒ
å»ºè®®ä½¿ç”¨ Python 3.8+ ç¯å¢ƒï¼š
```bash
# åˆ›å»ºç¯å¢ƒ
conda create -n py38 python=3.8
conda activate py38

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 2.2 ç›®å½•ç»“æ„
```text
â”œâ”€â”€ datasets/            # æ•°æ®é›† (Safety-Helmet-Wearing-Dataset)
â”œâ”€â”€ models/              # æ¨¡å‹é…ç½®æ–‡ä»¶ (YAML)
â”‚   â”œâ”€â”€ yolov11s-cbam.yaml      # åˆ›æ–°ç‰ˆ (CBAM)
â”‚   â””â”€â”€ yolov11s-cbam-p2.yaml   # è¿›é˜¶ç‰ˆ (CBAM + P2 Head)
â”œâ”€â”€ runs/                # è®­ç»ƒæ—¥å¿—ä¸æƒé‡ä¿å­˜
â”œâ”€â”€ src/                 # æºä»£ç 
â”‚   â”œâ”€â”€ train.py         # è®­ç»ƒå…¥å£è„šæœ¬å½“
â”‚   â”œâ”€â”€ predict.py       # æ‰¹é‡æ¨ç†è„šæœ¬
â”‚   â”œâ”€â”€ web_demo.py      # Streamlit å¯è§†åŒ–æ¼”ç¤º
â”‚   â”œâ”€â”€ modules.py       # è‡ªå®šä¹‰æ¨¡å— (CBAM)
â”‚   â”œâ”€â”€ loss.py          # è‡ªå®šä¹‰æŸå¤± (Inner-WIoU)
â”‚   â””â”€â”€ utils.py         # å·¥å…·å‡½æ•°
â”œâ”€â”€ train_config.yaml          # ã€é»˜è®¤ã€‘è®­ç»ƒé…ç½® (CBAM + Inner-WIoU)
â”œâ”€â”€ train_config_baseline.yaml # ã€å¯¹æ¯”ã€‘åŸºå‡†é…ç½® (åŸç‰ˆ YOLOv11s)
â”œâ”€â”€ train_config_p2.yaml       # ã€è¿›é˜¶ã€‘P2å±‚é…ç½® (å¾®å°ç›®æ ‡ä¼˜åŒ–)
â””â”€â”€ requirements.txt     # ä¾èµ–åˆ—è¡¨
```

---

## 3. è®­ç»ƒæŒ‡å— (Training Guide)

æœ¬é¡¹ç›®æ”¯æŒé€šè¿‡å‘½ä»¤è¡Œå‚æ•°ä¸€é”®åˆ‡æ¢ä¸åŒå®éªŒé…ç½®ï¼Œæ–¹ä¾¿è¿›è¡Œæ¶ˆèå®éªŒ (Ablation Study)ã€‚

### 3.1 è¿è¡Œåˆ›æ–°ç‰ˆæ¨¡å‹ (CBAM + Inner-WIoU)
è¿™æ˜¯ç›®å‰çš„ stable ç‰ˆæœ¬ï¼Œå¹³è¡¡äº†ç²¾åº¦ä¸é€Ÿåº¦ã€‚
```bash
python src/train.py --config train_config.yaml
```

### 3.2 è¿è¡ŒåŸç‰ˆåŸºå‡†æ¨¡å‹ (Baseline)
ç”¨äºè®ºæ–‡ä¸­ä½œä¸º Baseline å¯¹æ¯”ï¼Œè¯æ˜æ”¹è¿›æœ‰æ•ˆã€‚
```bash
python src/train.py --config train_config_baseline.yaml
```

### 3.3 è¿è¡Œ P2å¾®å°ç›®æ ‡æ¨¡å‹ (Advanced)
**æ¨èï¼** é’ˆå¯¹æ¼æ£€é—®é¢˜è¿›è¡Œäº†æ·±åº¦ä¼˜åŒ–ï¼Œå¢åŠ äº† P2 æ£€æµ‹å¤´ã€‚
```bash
python src/train.py --config train_config_p2.yaml
```

*æ³¨æ„ï¼šè®­ç»ƒç»“æœï¼ˆæƒé‡ best.ptã€æ—¥å¿—ã€æ›²çº¿å›¾ï¼‰ä¼šè‡ªåŠ¨ä¿å­˜åœ¨ `runs/train/exp_xxxx` ç›®å½•ä¸‹ã€‚*

---

## 4. æ¼”ç¤ºä¸æ¨ç† (Inference & Demo)

### 4.1 ç½‘é¡µç‰ˆå¯è§†åŒ–æ¼”ç¤º
å¯åŠ¨ Streamlit ç•Œé¢ï¼Œæ”¯æŒå›¾ç‰‡ä¸Šä¼ å’Œå®æ—¶è°ƒèŠ‚ç½®ä¿¡åº¦é˜ˆå€¼ã€‚
```bash
streamlit run src/web_demo.py
```
*(é»˜è®¤åŠ è½½ `train_config.yaml` ä¸­é…ç½®çš„ best.pt æƒé‡)*

### 4.2 æ‰¹é‡å›¾ç‰‡æ¨ç†
å¯¹å› ä¸ºæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰å›¾ç‰‡è¿›è¡Œé¢„æµ‹ã€‚
```bash
python src/predict.py
```

---

## 5. é¡¹ç›®çŠ¶æ€
- [x] YOLOv11s ç¯å¢ƒè·‘é€š
- [x] æ•°æ®é›†åŠ è½½ (Safety Helmet Dataset)
- [x] åˆ›æ–°ç‚¹1ï¼šCBAM å®ç°ä¸é›†æˆ
- [x] åˆ›æ–°ç‚¹2ï¼šInner-WIoU å®ç°ä¸é›†æˆ
- [x] åˆ›æ–°ç‚¹3ï¼šP2 å¾®å°ç›®æ ‡å¤´æ¶æ„è®¾è®¡ (Waiting for training)
- [x] è®­ç»ƒè„šæœ¬æ”¯æŒé€šè¿‡ Config åˆ‡æ¢æ¨¡å¼
- [x] Web Demo ç•Œé¢ä¼˜åŒ– (ä¿®å¤å˜è‰²ã€å¸ƒå±€é—®é¢˜)

---

## 6. å®éªŒç»“æœ (Experimental Results)

| å®éªŒç»„åˆ« (Experiment) | é…ç½®è¯´æ˜ (Configuration) | Precision (å‡†ç¡®ç‡) | Recall (å¬å›ç‡) | mAP@0.5 (å…¨ç±»å¹³å‡) | mAP@0.5:0.95 (é«˜ç²¾å¹³å‡) |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **Baseline** | (1) åŸç‰ˆ YOLOv11s | 92.53% | **89.52%** | 94.22% | 59.63% |
| **Ours (A)** | (2) + CBAM + Inner-WIoU | 93.06% | 88.27% | 94.25% | **59.93%** |
| **Ours (B)** | (3) + P2 Head (4å¤´æ£€æµ‹) | **93.48%** | 88.26% | **94.34%** | 58.96% |

**ç»“è®ºåˆ†æ**:
1.  **Ours (A)**: åœ¨ä¿æŒé«˜å‡†ç¡®ç‡çš„åŒæ—¶ï¼Œå®ç°äº†æœ€é«˜çš„ç»¼åˆæ£€æµ‹è´¨é‡ (mAP@0.5:0.95)ï¼Œé€‚åˆä½œä¸º**é€šç”¨æ£€æµ‹æ¨¡å‹**ã€‚
2.  **Ours (B)**: å¼•å…¥ P2 å±‚åï¼Œæ¨¡å‹å¯¹ç‰¹å¾çš„è¾¨è¯†åº¦è¿›ä¸€æ­¥æå‡ï¼Œè¾¾åˆ°äº†æœ€é«˜çš„å‡†ç¡®å‡†ç¡®ç‡ (Precision)ï¼Œé€‚åˆå¯¹è¯¯æŠ¥ç‡è¦æ±‚æé«˜çš„**ä¸¥æ ¼å®‰å…¨æ£€æŸ¥åœºæ™¯**ã€‚
